<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-adrs docs-version-current docs-doc-page docs-doc-id-decisions/2024-01-15-Error-handling-report-problem-agent" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Error Handling Report Problem for Agent | Hyperledger Identus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://hyperledger.github.io/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-adrs-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-adrs-current"><meta data-rh="true" property="og:title" content="Error Handling Report Problem for Agent | Hyperledger Identus"><meta data-rh="true" name="description" content="- Status: accepted"><meta data-rh="true" property="og:description" content="- Status: accepted"><link data-rh="true" rel="icon" href="/identus-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hyperledger.github.io/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent"><link data-rh="true" rel="alternate" href="https://hyperledger.github.io/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent" hreflang="en"><link data-rh="true" rel="alternate" href="https://hyperledger.github.io/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent" hreflang="x-default"><link rel="stylesheet" href="/identus-docs/assets/css/styles.7aa07c05.css">
<script src="/identus-docs/assets/js/runtime~main.5fd36d3d.js" defer="defer"></script>
<script src="/identus-docs/assets/js/main.ef8fbe70.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/identus-docs/"><div class="navbar__logo"><img src="/identus-docs/img/identus-navbar-light.png" alt=" Identus logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/identus-docs/img/identus-navbar-light.png" alt=" Identus logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/identus-docs/docs/getting-started">Docs</a><a class="navbar__item navbar__link" href="/identus-docs/tutorials/">Tutorials</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/identus-docs/adrs/">ADRs</a><a class="navbar__item navbar__link" href="/identus-docs/agent-api/">Agent API</a><div class="navbar__item dropdown dropdown--hoverable"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent">SDKs</a><ul class="dropdown__menu"><li><a href="https://hyperledger.github.io/identus-edge-agent-sdk-swift/documentation/edgeagentsdk/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Edge Agent SDK Swift<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/identus-docs/identus-edge-agent-sdk-ts/sdk">Edge Agent SDK Typescript</a></li><li><a href="https://hyperledger.github.io/identus-edge-agent-sdk-kmp/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Edge Agent SDK Kotlin Multiplatform<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/input-output-hk/prism-did-method-spec/blob/main/w3c-spec/PRISM-method.md" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">PRISM DID Spec<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/identus-docs/adrs/">ADRs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/identus-docs/adrs/template">Template</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/identus-docs/adrs/decisions/2022-09-19-use-markdown-architectural-decision-records">Decisions</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/adrs/decisions/2022-09-19-use-markdown-architectural-decision-records">Use Markdown Architectural Decision Records</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/adrs/decisions/2022-10-05-using-tapir-library-as-a-dsl-for-openapi-specification">Using tapir library as a DSL for OpenAPI specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/adrs/decisions/2022-10-06-store-private-keys-of-issuers-inside-prism-agent">Store private keys of Issuers inside the Cloud Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/adrs/decisions/2023-01-18-quill-library-for-sql-statement-generation">Quill library for SQL statement generation and validation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/adrs/decisions/2023-04-05-did-linked-resources">DID-linked-resources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/adrs/decisions/2023-05-09-message-routing-for-multi-tenant">Routing Requests to the Correct Tenant</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/adrs/decisions/2023-05-15-mediator-message-storage">Mediator message storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/adrs/decisions/2023-05-16-hierarchical-deterministic-key-generation-algorithm">Hierarchical deterministic key generation algorithm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/adrs/decisions/2023-05-18-data-isolation-for-multitenancy">Data isolation for multi-tenancy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/adrs/decisions/2023-05-27-use-keycloak-and-jwt-tokens-for-authentication-and-authorisation-to-facilitate-multitenancy-in-cloud-agent">Use Keycloak and JWT tokens for Authentication and Authorisation to facilitate multitenancy in the Cloud Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/adrs/decisions/2023-06-28-apollo-as-centralised-and-secure-cryptography-management-module">Apollo as centralised and secure cryptography management module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/adrs/decisions/2023-07-14-performance-framework-for-atala-prism">Performance framework for the Identus platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/adrs/decisions/2023-09-26-use-keycloak-authorisation-service-for-managing-wallet-permissions">Use keycloak authorisation service for managing wallet permissions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/adrs/decisions/2023-09-28-revocation-status-list-expansion-strategy">JWT credential revocation status list expansion strategy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/adrs/decisions/2024-01-03-use-jwt-claims-for-agent-admin-auth">Use JWT claims for agent admin access control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent">Error Handling Report Problem for Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/adrs/decisions/2024-01-16-use-zio-failures-and-defects-effectively">Use ZIO Failures and Defects Effectively</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/adrs/decisions/2024-03-07-handle-errors-in-bg-jobs-by-storing-on-state-records-and-sending-via-webhooks">Handle errors in background jobs by storing on state records and sending via webhooks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/identus-docs/adrs/decisions/2024-05-20-use-did-urls-to-reference-resources">Storage for SSI related resources</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/identus-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Decisions</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Error Handling Report Problem for Agent</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Error Handling Report Problem for Agent</h1>
<ul>
<li>Status: accepted</li>
<li>Deciders: Shailesh Patil, Fabio Pinheiro, Yurii Shynbuiev, Benjamin Voiturier, David Poltorak</li>
<li>Date: 2024-01-16</li>
<li>Tags: report, problem, error, handling, agent</li>
</ul>
<p>Technical Story: [Error Handling Report Problem for Agent]</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="context-and-problem-statement">Context and Problem Statement<a class="hash-link" aria-label="Direct link to Context and Problem Statement" title="Direct link to Context and Problem Statement" href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent#context-and-problem-statement">​</a></h2>
<p>In decentralized systems like those with remote collaborating agents, effectively reporting errors and warnings is a complex task.
It&#x27;s crucial to not only highlight problems but also provide the necessary context to those who need this information,
which might include different groups: those who should be informed and those who can actually resolve the issues.</p>
<p>It is more challenging when a problem is identified significantly later or in a different location from where it originated,
involving collaboration among various parties for a solution.
For DIDComm, the aspect of interoperability is especially critical in the context of problem reporting.
In DIDComm, an agent developed by one team is required to be adept at interpreting errors reported by an agent from a completely different team,
presenting a unique challenge in this area.</p>
<p>As of the time of writing, the Cloud Agent supports 3 DIDComm flows: <code>Connection</code>, <code>Issuance</code> and <code>Verification.</code>
Each Cloud Agent operates a background thread that facilitates interactions between two agents.
For each flow, the agent tracks a protocol state, and depending on this state, it triggers a DIDComm(V2) message to communicate with the other agent.
The communication between two agents, Agent A and Agent B, occurs asynchronously in the background job.
If an error occurs in this background job over DIDComm in Agent A, it is recorded in Agent A&#x27;s logs. However, Agent B remains uninformed about any such errors.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="decision-drivers-">Decision Drivers <a class="hash-link" aria-label="Direct link to Decision Drivers " title="Direct link to Decision Drivers " href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent#decision-drivers-">​</a></h2>
<p>What are our needs? Let’s try to sum up the required capabilities based on
<a href="https://identity.foundation/didcomm-messaging/spec/#problem-reports" target="_blank" rel="noopener noreferrer">Report Problem 2.0</a>, we need:</p>
<p>The Cloud Agent is designed to perform three distinct roles: <code>Issuer</code>, <code>Holder</code>, and <code>Verifier</code>. Within these roles,
it operates across three protocol flows, namely <code>Connection</code>, <code>Issuance</code>, and <code>Verification</code>.</p>
<table><thead><tr><th>Agent(Protocol) Flows</th><th>Protocols</th></tr></thead><tbody><tr><td>Connection</td><td>[<a href="https://github.com/hyperledger/aries-rfcs/tree/main/features/0160-connection-protocol" target="_blank" rel="noopener noreferrer">https://github.com/hyperledger/aries-rfcs/tree/main/features/0160-connection-protocol</a>]</td></tr><tr><td>Issuance</td><td>[<a href="https://github.com/decentralized-identity/waci-didcomm/tree/main/issue_credential" target="_blank" rel="noopener noreferrer">https://github.com/decentralized-identity/waci-didcomm/tree/main/issue_credential</a>]</td></tr><tr><td>Verification(Present proof)</td><td>[<a href="https://github.com/decentralized-identity/waci-didcomm/blob/main/present_proof/present-proof-v3.md" target="_blank" rel="noopener noreferrer">https://github.com/decentralized-identity/waci-didcomm/blob/main/present_proof/present-proof-v3.md</a>]</td></tr></tbody></table>
<p>Custom Behavior table
This table defines the expected behavior of the Agent in different scenarios not covered by the specifications.</p>
<table><thead><tr><th>Agent</th><th>Behaviour</th><th>Action</th></tr></thead><tbody><tr><td>Scenario G1</td><td>Send a problem report</td><td>e.p.msg.unsupported</td></tr><tr><td>Scenario G2</td><td>Send a problem report</td><td>e.p.msg.unsupported</td></tr><tr><td>Scenario G3</td><td>Send a problem report</td><td>e.p.error</td></tr><tr><td>Scenario G4</td><td>(Sync ?) Send a problem report</td><td>e.p.trust.crypto</td></tr><tr><td>Scenario G5</td><td>(Sync ?) Send a problem report</td><td>e.p.did</td></tr><tr><td>Scenario G6</td><td>(Sync ?) Send a problem report</td><td>e.p.did.malformed</td></tr><tr><td>Scenario G7</td><td>Send a problem report</td><td>e.p.msg.&lt;PIURI&gt;</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scenarios-description">Scenarios Description<a class="hash-link" aria-label="Direct link to Scenarios Description" title="Direct link to Scenarios Description" href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent#scenarios-description">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="general-scenarios">General Scenarios<a class="hash-link" aria-label="Direct link to General Scenarios" title="Direct link to General Scenarios" href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent#general-scenarios">​</a></h4>
<ul>
<li>
<p><strong>G1</strong> - Receive a message for an unsupported protocol</p>
</li>
<li>
<p>G1 - Send a problem report <code>e.p.msg.unsupported</code></p>
</li>
<li>
<p><strong>G2</strong> - Receive a message for an unsupported version of the protocol.</p>
</li>
<li>
<p>G2 - Send a problem report <code>e.p.msg.unsupported</code> and say what version(s) its supported</p>
</li>
<li>
<p><strong>G3</strong> - When an internal error or any unexpected error happens.</p>
</li>
<li>
<p>G3 - Send a problem report &quot;e.p.error&quot;</p>
</li>
<li>
<p><strong>G4</strong> - If the message is tampered or got any crypto errors when decoding.</p>
</li>
<li>
<p>G4 -  (sync!) Send a problem report &quot;e.p.trust.crypto&quot;</p>
</li>
<li>
<p><strong>G5</strong> - If the DID method is not supported (<code>did.peer</code> in this case)</p>
</li>
<li>
<p>G5 - (sync?) e.p.did</p>
</li>
<li>
<p><strong>G6</strong> - If the DID method is malformed.</p>
</li>
<li>
<p>G6 - (sync?) e.p.did.malformed</p>
</li>
<li>
<p><strong>G7</strong> - When a parsing error from the decrypted message.</p>
</li>
<li>
<p>G7 - Send a problem report <code>e.p.msg.&lt;PIURI&gt;</code> if the plaintext message is malformed or if parsing into a specific protocol&#x27;s data model fails.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="connection-flow-scenarios">Connection Flow Scenarios<a class="hash-link" aria-label="Direct link to Connection Flow Scenarios" title="Direct link to Connection Flow Scenarios" href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent#connection-flow-scenarios">​</a></h2>
<p>[<a href="https://github.com/hyperledger/aries-rfcs/tree/main/features/0160-connection-protocol" target="_blank" rel="noopener noreferrer">https://github.com/hyperledger/aries-rfcs/tree/main/features/0160-connection-protocol</a>]</p>
<table><thead><tr><th>Agent</th><th>Behaviour</th><th>Action</th></tr></thead><tbody><tr><td>Scenario C1</td><td>Send a problem report (Invitation expired)</td><td>e.p.msg.invitation-expired</td></tr><tr><td>Scenario C2</td><td>Send a problem report (Invitation parsing decoding)</td><td>e.p.msg.malformed-invitation</td></tr><tr><td>Scenario C3</td><td>Send a problem report (DB connection issues)</td><td>e.p.me.res.storage</td></tr><tr><td>Scenario C4</td><td>Send a problem report (After max retries)</td><td>e.p.req.max-retries-exceeded</td></tr><tr><td>Scenario C5 (G3)</td><td>Send a problem report Any other error</td><td>e.p.error</td></tr></tbody></table>
<ul>
<li><strong>C1</strong> - OOB Invitation has expired</li>
<li><strong>C2</strong> - OOB is tampered / decoding error</li>
<li><strong>C3</strong> - Database connection or related issue</li>
<li><strong>C4</strong> - Max retries (Cascading Problems): Connection state cannot be moved after max retries</li>
<li><strong>C5</strong> - See G3</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="issuance-flow-scenarios">Issuance Flow Scenarios<a class="hash-link" aria-label="Direct link to Issuance Flow Scenarios" title="Direct link to Issuance Flow Scenarios" href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent#issuance-flow-scenarios">​</a></h2>
<p>[<a href="https://github.com/decentralized-identity/waci-didcomm/tree/main/issue_credential" target="_blank" rel="noopener noreferrer">https://github.com/decentralized-identity/waci-didcomm/tree/main/issue_credential</a>]</p>
<table><thead><tr><th>Agent</th><th>Behaviour</th><th>Action</th></tr></thead><tbody><tr><td>Scenario I1</td><td>Send a problem report</td><td>e.p.msg.credential-format-mismatch</td></tr><tr><td>Scenario I2</td><td>Send a problem report</td><td>e.p.msg.invalid-signature</td></tr><tr><td>Scenario I3</td><td>Send a problem report</td><td>e.p.msg.schema-mismatch</td></tr><tr><td>Scenario I4</td><td>Send a problem report (DB connection issues)</td><td>e.p.me.res.storage</td></tr><tr><td>Scenario I5</td><td>Send a problem report (After max retries)</td><td>e.p.req.max-retries-exceeded</td></tr><tr><td>Scenario I6(G3)</td><td>Send a problem report Any other error</td><td>e.p.error</td></tr></tbody></table>
<ul>
<li><strong>I1</strong> - Credential format mismatch: The Holder expects a credential format schema, but the credential issued is different format</li>
<li><strong>I2</strong> - Credential signature that cannot be verified. This might be due to the credential being tampered with, or the public key used for signing being incorrect or expired.</li>
<li><strong>I3</strong> - Schema Mismatch: The Holder expects a credential that adheres to a certain schema, but the credential presented follows a different schema.</li>
<li><strong>I4</strong> - Database connection or related issue</li>
<li><strong>I5</strong> - Max retries (Cascading Problems): Issuance state cannot be moved after max retries</li>
<li><strong>I6</strong> - See G3</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="verificationpresent-proof--flow-scenarios">Verification(Present proof)  Flow Scenarios<a class="hash-link" aria-label="Direct link to Verification(Present proof)  Flow Scenarios" title="Direct link to Verification(Present proof)  Flow Scenarios" href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent#verificationpresent-proof--flow-scenarios">​</a></h2>
<p>[<a href="https://github.com/decentralized-identity/waci-didcomm/blob/main/present_proof/present-proof-v3.md" target="_blank" rel="noopener noreferrer">https://github.com/decentralized-identity/waci-didcomm/blob/main/present_proof/present-proof-v3.md</a>]</p>
<table><thead><tr><th>Agent</th><th>Behaviour</th><th>Action</th></tr></thead><tbody><tr><td>Scenario V1</td><td>Send a problem report</td><td>e.p.msg.credential-format-mismatch</td></tr><tr><td>Scenario V2</td><td>Send a problem report</td><td>e.p.msg.invalid-signature</td></tr><tr><td>Scenario V3</td><td>Send a problem report</td><td>e.p.msg.revoked-credentials</td></tr><tr><td>Scenario V4</td><td>Send a problem report</td><td>e.p.msg.expired-credentials</td></tr><tr><td>Scenario V5</td><td>Send a problem report</td><td>e.p.msg.proof-mismatch</td></tr><tr><td>Scenario V6</td><td>Send a problem report</td><td>e.p.msg.schema-mismatch</td></tr><tr><td>Scenario V7</td><td>Send a problem report</td><td>e.p.msg.revoked-or-expired-issuer-key</td></tr><tr><td>Scenario V8</td><td>Send a problem report (After max retries)</td><td>e.p.req.max-retries-exceeded</td></tr><tr><td>Scenario V9(G3)</td><td>Send a problem report Any other error</td><td>e.p.error</td></tr><tr><td>Scenario V10</td><td>Send a problem report (DB connection issues)</td><td>e.p.me.res.storage</td></tr></tbody></table>
<ul>
<li><strong>V1</strong> - Credential Format Mismatch: The verifier expects a credential in a specific format, but the prover presents it in a different format.</li>
<li><strong>V2</strong> - Credentials presented have signatures that cannot be verified. This might be due to the credential being tampered with, or the public key used for verification being incorrect.</li>
<li><strong>V3</strong> - Revoked Credentials: The prover presents a credential that has been revoked by the issuer</li>
<li><strong>V4</strong> - Expired Credentials: The credentials presented are past their expiry date, making them invalid for the transaction.</li>
<li><strong>V5</strong> - Mismatch in the Proof Request and Presentation: The verifier&#x27;s proof request asks for certain attributes or predicates, but the presentation from the prover doesn&#x27;t match these requirements.</li>
<li><strong>V6</strong> - Schema Mismatch: The verifier expects a credential that adheres to a certain schema, but the credential presented follows a different schema.</li>
<li><strong>V7</strong> - Credential Format Mismatch: The verifier expects a credential in a specific format, but the prover presents it in a different format.</li>
<li><strong>V8</strong> - Max retries (Cascading Problems): Verification State cannot be moved after max retries</li>
<li><strong>V9</strong> - See G3</li>
<li><strong>V10</strong> - Database connection or related issue</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="decision-outcome">Decision Outcome<a class="hash-link" aria-label="Direct link to Decision Outcome" title="Direct link to Decision Outcome" href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent#decision-outcome">​</a></h2>
<p>In the event of an issue in the Cloud Agent, the following actions are taken:</p>
<ol>
<li>
<p>The error is logged, including the X-Request-ID and the thread ID (thid).</p>
</li>
<li>
<p>A problem report message is generated and sent out as outlined in the previously mentioned table
This message is sent in accordance with the return route defined here:
<a href="https://github.com/decentralized-identity/didcomm-messaging/blob/main/extensions/return_route/main.md" target="_blank" rel="noopener noreferrer">Return Route Extension for DIDComm Messaging</a>.</p>
</li>
<li>
<p><a href="https://didcomm.org/report-problem/2.0/" target="_blank" rel="noopener noreferrer">Implement the Problem Reporting</a></p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="out-of-the-scope">Out of the Scope<a class="hash-link" aria-label="Direct link to Out of the Scope" title="Direct link to Out of the Scope" href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent#out-of-the-scope">​</a></h3>
<ol>
<li>
<p>The problem report generated is not stored in the database along with the associated X-Request-ID.</p>
</li>
<li>
<p><a href="https://identity.foundation/didcomm-messaging/spec/#replying-to-warnings" target="_blank" rel="noopener noreferrer">Replying to Warnings</a></p>
</li>
<li>
<p><a href="https://identity.foundation/didcomm-messaging/spec/#acks" target="_blank" rel="noopener noreferrer">ACKs</a></p>
</li>
</ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/identus-docs/adrs/decisions/2024-01-03-use-jwt-claims-for-agent-admin-auth"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Use JWT claims for agent admin access control</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/identus-docs/adrs/decisions/2024-01-16-use-zio-failures-and-defects-effectively"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Use ZIO Failures and Defects Effectively</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent#context-and-problem-statement">Context and Problem Statement</a></li><li><a class="table-of-contents__link toc-highlight" href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent#decision-drivers-">Decision Drivers </a><ul><li><a class="table-of-contents__link toc-highlight" href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent#scenarios-description">Scenarios Description</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent#connection-flow-scenarios">Connection Flow Scenarios</a></li><li><a class="table-of-contents__link toc-highlight" href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent#issuance-flow-scenarios">Issuance Flow Scenarios</a></li><li><a class="table-of-contents__link toc-highlight" href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent#verificationpresent-proof--flow-scenarios">Verification(Present proof)  Flow Scenarios</a></li><li><a class="table-of-contents__link toc-highlight" href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent#decision-outcome">Decision Outcome</a><ul><li><a class="table-of-contents__link toc-highlight" href="/identus-docs/adrs/decisions/2024-01-15-Error-handling-report-problem-agent#out-of-the-scope">Out of the Scope</a></li></ul></li></ul></div></div></div></div></main></div></div></div><div class="container"><footer class="footer_J6tW"><svg xmlns="http://www.w3.org/2000/svg" width="145" height="38" fill="none"></svg><span class="copyright_C6JK">Hyperledger Identus CC BY 4.0</span></footer></div></div>
</body>
</html>